The search query returned results that are OFF-TOPIC for the research question.

Original Research Question: "{{ research_question }}"
Current Query: "{{ original_query }}"
Results Found: {{ results_count }} (but not relevant)

Reformulate the query to be more specific while PRESERVING the original query's intent.

Guidelines:
- PRESERVE the core intent of "{{ original_query }}" (this is a specific subtask, not the full research question)
- ADD specific context from the research question to clarify the domain/focus
- If the original query is very generic (e.g., "official documentation"), add domain-specific terms (e.g., "cybersecurity clearance documentation")
- If the research question mentions a specific entity (e.g., "NSA"), clarify which one (e.g., "National Security Agency" not "Naval Support Activity")
- Remove generic terms that cause topic drift

Examples:
- Research: "NSA cybersecurity contracts" / Current: "NSA contracts" → "National Security Agency cybersecurity contracts" (preserved "contracts", added "National Security Agency" clarity)
- Research: "JSOC operations Iraq" / Current: "JSOC" → "Joint Special Operations Command Iraq operations" (preserved entity, added full name + context)
- Research: "cybersecurity jobs for cleared professionals" / Current: "official documentation" → "security clearance requirements official documentation" (preserved "official documentation" intent, added clearance context)

{% if source_performance %}
SOURCE PERFORMANCE (previous retry attempt):
{% for source in source_performance %}
- **{{ source.name }}**: {{ source.status }}
  {% if source.status == "success" %}Results: {{ source.results_returned }}, Kept: {{ source.results_kept }} ({{ source.quality_rate }}% quality){% endif %}
  {% if source.status == "low_quality" %}Results: {{ source.results_returned }}, Kept: {{ source.results_kept }} (all rejected as off-topic){% endif %}
  {% if source.status == "zero_results" %}No results found{% endif %}
  {% if source.status == "error" %}Error: {{ source.error_type }} (infrastructure issue, not query-related){% endif %}
{% endfor %}

AVAILABLE SOURCES (can query on this retry):
{{ available_sources|join(', ') }}

SOURCE RE-SELECTION DECISION:
You can now intelligently adjust which sources to query based on performance:
- **KEEP**: Sources that performed well (high quality results, good signal)
- **DROP**: Sources with poor performance (all results rejected, off-topic, or persistent errors)
- **ADD**: Sources not yet tried that might have better results for this query

Guidelines:
- Drop sources with 0% quality rate (all results rejected)
- Drop sources with persistent errors (rate limits, auth failures - won't recover)
- Keep sources with high quality results (>50% kept)
- Add untried sources that might better match the reformulated query
- Consider source strengths: USAJobs (structured jobs), ClearanceJobs (cleared roles), Brave (general web), Twitter (real-time)

{% endif %}
OPTIONAL - Source-Specific Parameter Adjustments:
If the query would benefit from adjusting source-specific parameters, suggest them:

Reddit parameters:
- time_filter: "hour" | "day" | "week" | "month" | "year" | "all"
  (Use "year" or "all" if searching for historical/comprehensive content)

USAJobs parameters:
- keywords: Prefer single broad keyword over multi-word phrases
  (e.g., "cybersecurity" gets more results than "cybersecurity analyst")

Twitter parameters:
- search_type: "Latest" | "Top" | "People" | "Photos" | "Videos"
  (Use "Top" for authoritative/popular tweets, "Latest" for recent/timely)
- max_pages: 1-3 (Number of result pages to fetch, more pages = more results but slower)
  (Increase if zero/low results, decrease if getting too many off-topic results)

IMPORTANT: Only suggest Twitter params for low quality/zero results, NOT for errors (rate limits, timeouts).

Return JSON with:
{
  "query": "new query text",
  "source_adjustments": {
    "keep": ["USAJobs", "ClearanceJobs"],
    "drop": ["Brave Search"],
    "add": ["SAM.gov"],
    "reasoning": "Why you made these source selection decisions (1-2 sentences)"
  },
  "param_adjustments": {
    "reddit": {"time_filter": "year"},
    "usajobs": {"keywords": "broad keyword"},
    "twitter": {"search_type": "Top", "max_pages": 2}
  }
}

NOTE: source_adjustments is OPTIONAL - only include if you want to change source selection.
If source_adjustments is omitted, all previously selected sources will be queried again.
