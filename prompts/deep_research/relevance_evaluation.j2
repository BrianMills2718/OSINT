Evaluate these search results for relevance, filter to the best ones, and decide if more searching is needed.

Original Research Question: "{{ research_question }}"
Search Query Used: "{{ task_query }}"

{% if source_execution_status %}
SOURCE EXECUTION STATUS (CRITICAL for continue/stop decision):
{% for source, status in source_execution_status.items() %}
- {{ source }}: {{ status.status }}{% if status.error %} ({{ status.error }}){% endif %}{% if status.results_count is defined %}, {{ status.results_count }} results{% endif %}
{% endfor %}

**Source Failure Impact Analysis:**
Before deciding to STOP searching, you MUST consider:
1. **Which sources were expected to have relevant data?** (e.g., for federal contracts: USAspending, SAM.gov are primary sources)
2. **Did those primary sources succeed or fail?**
3. **If primary sources failed, results from secondary sources alone may be INSUFFICIENT**
4. **Failures could be: API errors (422/429), timeouts, rate limits, or validation errors**

**DO NOT STOP if primary sources failed** - the data likely exists but we couldn't access it.
**DO CONTINUE** if important sources had errors/timeouts - try different queries or wait for rate limits to clear.
{% endif %}

Search Results (numbered):
{{ results_text }}

Your task has THREE parts:

1. **DECISION**: Should we ACCEPT or REJECT these results as a batch?
   - ACCEPT if ANY results are relevant (even if only a few)
   - REJECT only if ALL results are completely off-topic

2. **FILTERING**: Which specific results should we keep? (Return their numbers)
   - List the indices of RELEVANT results only (e.g., [0, 2, 5])
   - Exclude off-topic, duplicate, or low-quality results
   - If REJECT, return empty list []

3. **CONTINUATION**: Should we search for MORE results?
   - true = reformulate query and search again (want more coverage)
   - false = sufficient results found, stop searching this task

Guidelines:

ACCEPT + Filter + Continue:
- Found some relevant results BUT want more coverage
- Example: 2 FOIA docs found → Keep [0, 1], continue searching for more

ACCEPT + Filter + Stop:
- Found sufficient high-quality results
- Example: 8 relevant results → Keep [0,1,2,3,4,5,6,7], stop (enough coverage)

REJECT + Empty + Continue:
- All results off-topic, reformulate query
- Example: Wrong entity (Naval Support vs NSA) → Keep [], continue with better query

Special cases:
- Classified/sensitive topics: Accept indirect evidence (leaks, FOIA, budget items)
- Sparse topics: Accept best available evidence even if limited
- Mixed batches: Keep only relevant results, may continue for more

Examples:
- Question: "What classified CIA programs exist?" + Results: 2 FOIA docs + 8 procurement notices
  → ACCEPT, keep [0,1], continue=true (those 2 are valuable, want more)

- Question: "NSA cybersecurity programs" + Results: All about Naval Support Activity
  → REJECT, keep [], continue=true (wrong entity, reformulate)

- Question: "Palantir government contracts" + Results: 10 relevant contracts
  → ACCEPT, keep [0,1,2,3,4,5,6,7,8,9], continue=false (sufficient coverage)

4. **REASONING BREAKDOWN**: Explain your decision-making process like an expert researcher
   - Highlight 3-5 interesting decisions (borderline cases, surprising keeps/rejects)
   - Describe your overall filtering strategy for this batch
   - Identify patterns you noticed across results
   - **CRITICAL**: Analyze source failures and their impact on your continue/stop decision

Return your decision in this format:
{
  "decision": "ACCEPT" or "REJECT",
  "reason": "brief explanation",
  "relevant_indices": [list of numbers],
  "continue_searching": true or false,
  "continuation_reason": "why continue/stop - MUST reference source failures if any occurred",
  "reasoning_breakdown": {
    "filtering_strategy": "Your overall approach to filtering this batch",
    "interesting_decisions": [
      {
        "result_index": 0,
        "action": "kept" or "rejected",
        "reasoning": "Why this specific decision was interesting or borderline"
      }
    ],
    "patterns_noticed": "Patterns or trends you observed across the results",
    "source_failure_analysis": "Which sources failed? Were they primary sources for this query type? Should we continue searching because key sources are unavailable? Leave empty string if no failures."
  }
}
