Synthesize these research findings into a comprehensive report.

Original Question: {{ original_question }}

Research Summary:
- Tasks Executed: {{ tasks_executed }}
- Total Results: {{ total_results }}
- Entities Discovered: {{ entities_discovered }}

Entity Relationships:
{{ relationship_summary }}

Top Findings (from {{ total_results }} results):
{{ top_findings_json }}

Create a detailed markdown report with:

# Research Report: [Title based on question]

## Executive Summary
[3-5 sentences on the most important findings, phrased for an investigator. Use dates/quotes when they materially support the point and always cite the source URL. Be explicit about what was actually found vs. unsubstantiated chatter.]

## Key Documents & Links
Order by how well each item advances the question and its credibility signals. Use labels as helpful context (e.g., [PRIMARY] official/archival; [ANALYSIS] media/think-tank/legal; [LEAD] unverified/social). Include short quotes only when paired with the source URL and when they strengthen understanding.
{% if key_documents %}
{% for doc in key_documents %}
- [{{ doc.title }}]({{ doc.url }}) — {{ doc.source }}{% if doc.date %} ({{ doc.date }}){% endif %}
{% endfor %}
{% else %}
- No key documents surfaced in this run.
{% endif %}

{% if timeline %}
## Timeline (Key Publications/Events)
{% for item in timeline %}
- {{ item.date }}: [{{ item.title }}]({{ item.url }})
{% endfor %}
{% else %}
No dated events extracted from collected sources.
{% endif %}

{# Findings by angle are captured in metadata/logs; keep main narrative focused. #}

{% if source_counts %}
## Coverage Snapshot
- Per-source results:
{% for source, count in source_counts.items() %}
  - {{ source }}: {{ count }}
{% endfor %}
{% endif %}

## Scope & Sanity Checks
- Tasks executed: {{ tasks_executed }}; Total results after dedup: {{ total_results }}; Entities discovered: {{ entities_discovered }}
- Coverage decisions recorded: {% if coverage_decisions_by_task %}yes ({{ coverage_decisions_by_task|length }} task(s)){% else %}no (only baseline hypotheses or timeouts){% endif %}
{% if sanity_metrics %}- Per-task: {% for m in sanity_metrics %}[Task {{ m.id }}: {{ m.total_results }} results, {{ m.hypotheses_executed }} hypotheses]{% if not loop.last %}; {% endif %}{% endfor %}{% endif %}

{% if hypotheses_by_task %}
## Suggested Investigative Angles

This research explored multiple investigative hypotheses for each subtask. Below are the pathways the LLM identified as promising:

{% for task_id, hypothesis_data in hypotheses_by_task.items() %}
**Task {{ task_id }}**: {{ task_queries.get(task_id, 'Unknown task') }}

{% for hypothesis in hypothesis_data.hypotheses %}
- **Hypothesis {{ hypothesis.id }}** ({{ hypothesis.confidence }}% confidence, Priority {{ hypothesis.exploration_priority }}):
  - *Statement*: {{ hypothesis.statement }}
  - *Reasoning*: {{ hypothesis.confidence_reasoning }}
  - *Search Strategy*:
    - Sources: {{ hypothesis.search_strategy.sources|join(', ') }}
    - Key Signals: {{ hypothesis.search_strategy.signals|join(', ') }}
    - Expected Entities: {{ hypothesis.search_strategy.expected_entities|join(', ') }}
  - *Priority Reasoning*: {{ hypothesis.priority_reasoning }}

{% endfor %}

*Coverage Assessment*: {{ hypothesis_data.coverage_assessment }}

{% endfor %}
{% if hypothesis_execution_summary %}

## Hypothesis Execution Results

Summary of executed hypotheses from this run (mode: execution):

{% for task_id, runs in hypothesis_execution_summary.items() %}
**Task {{ task_id }}**: {{ task_queries.get(task_id, 'Unknown task') }}

{% for run in runs %}
- Hypothesis {{ run.hypothesis_id }} → {{ run.results_count }} results (Sources: {{ run.sources|join(', ') }})
  {% if run.delta_metrics %}
  - Incremental Contribution: {{ run.delta_metrics.results_new }} new + {{ run.delta_metrics.results_duplicate }} duplicate ({{ (run.delta_metrics.results_new / run.delta_metrics.total_results * 100)|round(1) if run.delta_metrics.total_results > 0 else 0 }}% new)
  {% endif %}
{% endfor %}

{% endfor %}

{% if coverage_decisions_by_task %}
## Coverage Assessment Decisions

{% for task_id, decisions in coverage_decisions_by_task.items() %}
**Task {{ task_id }}**: {{ task_queries.get(task_id, 'Unknown task') }}

{% for decision in decisions %}
- **After Hypothesis {{ decision.hypothesis_id }}** ({{ decision.executed_count }}/{{ decision.total_hypotheses }} executed):
  - **Decision**: {{ decision.decision|upper }}
  - **New Results**: {{ decision.results_new }} ({{ decision.incremental_gain_last_pct }}% of total)
  - **Assessment**: {{ decision.assessment }}
  {% if decision.gaps_identified %}
  - **Gaps Identified**: {{ decision.gaps_identified|join('; ') }}
  {% endif %}
{% endfor %}

{% endfor %}
{% endif %}
{% endif %}
{% endif %}

## Key Findings
[Bullet points of the most important discoveries with inline source cues (e.g., date/source). Lead with primary/official documents; clearly separate social claims as leads.]

## Detailed Analysis
[2-3 paragraphs connecting entities, documents, and events. Include short quotes or dates where possible. Note gaps or unverified claims explicitly.]

## Entity Network
[Description of key entities and their relationships]

## Data Sources
**Primary Integrations**: {% if integrations_used %}{{ integrations_used|join(', ') }}{% else %}None{% endif %}
{% if websites_found %}**Websites Discovered**: {{ websites_found|join(', ') }} (via web search){% endif %}

## Research Process Notes
{% for task in task_diagnostics %}
**Task {{ task.id }}**: {{ task.status }}
- Query: "{{ task.query }}"
- Results: {{ task.results_kept }} kept ({{ task.results_total }} evaluated)
- Decision: {{ task.continuation_reason }}
{% if task.reasoning_notes %}

*LLM Decision-Making Process*:
{% for note in task.reasoning_notes %}
  - **Attempt {{ note.attempt }}**: Evaluated {{ note.results_evaluated }} results ({{ note.decision }})
    - **Filtering Strategy**: {{ note.reasoning_breakdown.filtering_strategy }}
    {% if note.reasoning_breakdown.interesting_decisions %}
    - **Interesting Decisions**:
      {% for decision in note.reasoning_breakdown.interesting_decisions[:5] %}
      - Result #{{ decision.result_index }} ({{ decision.action }}): {{ decision.reasoning }}
      {% endfor %}
    {% endif %}
    {% if note.reasoning_breakdown.patterns_noticed %}
    - **Patterns Noticed**: {{ note.reasoning_breakdown.patterns_noticed }}
    {% endif %}
{% endfor %}
{% endif %}

{% endfor %}

{% if sanity_metrics %}
## Sanity Metrics

Quick checks to spot regressions (counts should match results.json):
{% for m in sanity_metrics %}
- **Task {{ m.id }}**: {{ m.total_results }} results, {{ m.hypotheses_executed }} hypotheses executed{% if m.hypothesis_result_counts %} (per-hyp results: {{ m.hypothesis_result_counts|join(', ') }}){% endif %}
{% endfor %}
{% endif %}

## Methodology
A total of {{ total_results }} relevant results were analyzed across {{ tasks_executed }} research tasks, leading to the discovery of {{ entities_discovered }} distinct entities and their interrelationships. The findings were synthesized to provide a comprehensive overview of the topic.

Make the report insightful and well-structured. Focus on connections and relationships, not just listing results.
