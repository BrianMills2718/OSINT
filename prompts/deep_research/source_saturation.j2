You are deciding whether to continue querying {{ source_name }} or if the source is saturated.

HYPOTHESIS: {{ hypothesis_statement }}

SOURCE: {{ source_name }}

SOURCE CHARACTERISTICS:
{{ source_metadata | tojson(indent=2) }}

QUERY HISTORY:
{% for query_attempt in query_history %}
{{ loop.index }}. Query: "{{ query_attempt.query }}"
   Results: {{ query_attempt.results_total }} total, {{ query_attempt.results_accepted }} accepted, {{ query_attempt.results_rejected }} rejected{% if query_attempt.results_duplicate %}, {{ query_attempt.results_duplicate }} duplicates{% endif %}
   Effectiveness: {{ (query_attempt.effectiveness * 100) | round(1) }}%
   {% if query_attempt.rejection_themes %}
   Rejection themes: {{ query_attempt.rejection_themes | join(', ') }}
   {% endif %}
{% else %}
No queries executed yet (this is the first query).
{% endfor %}

TOTAL RESULTS SO FAR: {{ total_results_accepted }} accepted across {{ query_history | length }} queries

CURRENT GAPS:
{% if information_gaps %}
{% for gap in information_gaps %}
- {{ gap }}
{% endfor %}
{% else %}
No specific gaps identified.
{% endif %}

QUERY QUALITY ASSESSMENT:

Before deciding saturation, analyze the query effectiveness patterns in the history above:

**Analyze Query Performance:**
1. **Zero results** (results_total = 0)
   - Does the source actually lack this information? (Consider source characteristics above)
   - Or is the query too specific/restrictive? (e.g., multiple AND operators, overly narrow timeframes)
   - Could broader terminology or fewer constraints help?

2. **Low acceptance rate** (effectiveness < 20%)
   - Are results off-topic for the hypothesis?
   - Is the query too broad, matching irrelevant content?
   - Are we searching in the wrong domain/timeframe?
   - Could more specific terms or constraints improve precision?

3. **High rejection themes**
   - What patterns appear in rejection_themes?
   - Do rejections suggest query mismatch (wrong source) or need refinement (right source, wrong query)?

4. **Diminishing returns**
   - Are recent queries less effective than earlier ones?
   - Are we exhausting the source's depth, or using less optimal query strategies?

**Consider Source Capabilities:**
Refer to the SOURCE CHARACTERISTICS above to understand:
- What query_strategies this source supports (keyword_search, boolean_operators, quoted_phrases, etc.)
- What characteristics define this source (community_discussions, formal_documents, realtime_feeds, etc.)
- What typical_result_count and max_queries_recommended suggest about source depth

**Quality Improvement Strategies:**
Based on the query_history patterns and source capabilities, consider:
- If too specific (0 results): Remove restrictive operators, broaden terminology, expand timeframes
- If too broad (low acceptance): Add specific constraints, use source-specific filters, narrow domain
- If wrong approach: Try different query_strategies from source metadata (e.g., subreddit_specific vs keyword_search)
- If saturation suspected: Verify with different angles, not just variations of same query

**Integration Intelligence:**
When suggesting next_query, ensure it:
- Aligns with source's supported query_strategies
- Learns from effectiveness patterns (avoid repeating failed approaches)
- Targets specific information_gaps
- Uses appropriate specificity for this source type (government databases vs social media vs web search)

DECISION FRAMEWORK:

Your goal: Determine if the information likely exists in this source AND if you've tried enough different strategies to find it.

**Human Investigation Principle:**
When queries fail or results decline, humans try different search strategies - not give up. Zero results or effectiveness drops mean "current approach isn't working" not "source exhausted."

**SATURATED** - Only when BOTH true:
1. **Strategy diversity exhausted**: You've tried multiple different query formulations/strategies (not just variations of the same approach)
2. **High existence confidence**: Strong evidence this information doesn't exist in this source given its nature and characteristics

**CONTINUE** - If EITHER true:
1. **Strategy diversity available**: Different query strategies, terminology, or angles you haven't tried yet
2. **Existence plausible**: Information could reasonably exist here, you just haven't found the right query approach

**Critical Thinking Questions:**
- Does this type of information likely exist given the source's nature? (government docs, social discussions, news coverage)
- Have I tried fundamentally different strategies, or just variations of the same approach?
- What strategies from source_metadata haven't I tried yet?
- If I were a human investigator, what different angle would I try next?

**What NOT to use as stop signals:**
- ❌ Effectiveness dropping (normal - means try different strategy)
- ❌ Zero results on current query (means current approach wrong, not source exhausted)
- ❌ Low acceptance rate alone (could be query formulation issue)
- ❌ Hitting max_queries_recommended (this is guidance, not hard limit if gaps remain)

**What ARE stop signals:**
- ✅ Tried 3+ fundamentally different strategies AND all failed
- ✅ Information type incompatible with source nature (e.g., classified docs on Twitter)
- ✅ Hitting only duplicates across multiple different query approaches

Return JSON:
{
    "decision": "SATURATED" or "CONTINUE",
    "reasoning": "2-4 sentences. If CONTINUE: What different strategy to try and why it might work. If SATURATED: What strategies you tried and why info likely doesn't exist.",
    "confidence": 0-100,  // Confidence in this decision
    "existence_confidence": 0-100,  // Does this info likely exist in this source? (0=unlikely, 100=very likely)
    "strategies_tried": ["list", "of", "different", "strategies", "attempted"],  // Helps assess strategy diversity
    "next_query_suggestion": "If CONTINUE, specific query using DIFFERENT strategy than previous attempts (empty if SATURATED)",
    "next_query_reasoning": "If CONTINUE, what makes this strategy different and why it should work (empty if SATURATED)",
    "expected_value": "high" | "medium" | "low",
    "remaining_gaps": [...]
}

**If CONTINUE**: Suggest a query using a fundamentally different strategy/angle than previous attempts. Explain what makes it different.

**If SATURATED**: List the different strategies you tried and explain why the information likely doesn't exist in this source.
