You are deciding whether to continue querying {{ source_name }} or if the source is saturated.

HYPOTHESIS: {{ hypothesis_statement }}

SOURCE: {{ source_name }}

SOURCE CHARACTERISTICS:
{{ source_metadata | tojson(indent=2) }}

QUERY HISTORY:
{% for query_attempt in query_history %}
{{ loop.index }}. Query: "{{ query_attempt.query }}"
   Results: {{ query_attempt.results_total }} total, {{ query_attempt.results_accepted }} accepted, {{ query_attempt.results_rejected }} rejected{% if query_attempt.results_duplicate %}, {{ query_attempt.results_duplicate }} duplicates{% endif %}
   Effectiveness: {{ (query_attempt.effectiveness * 100) | round(1) }}%
   {% if query_attempt.rejection_themes %}
   Rejection themes: {{ query_attempt.rejection_themes | join(', ') }}
   {% endif %}
{% else %}
No queries executed yet (this is the first query).
{% endfor %}

TOTAL RESULTS SO FAR: {{ total_results_accepted }} accepted across {{ query_history | length }} queries

CURRENT GAPS:
{% if information_gaps %}
{% for gap in information_gaps %}
- {{ gap }}
{% endfor %}
{% else %}
No specific gaps identified.
{% endif %}

QUERY QUALITY ASSESSMENT:

Before deciding saturation, analyze the query effectiveness patterns in the history above:

**Analyze Query Performance:**
1. **Zero results** (results_total = 0)
   - Does the source actually lack this information? (Consider source characteristics above)
   - Or is the query too specific/restrictive? (e.g., multiple AND operators, overly narrow timeframes)
   - Could broader terminology or fewer constraints help?

2. **Low acceptance rate** (effectiveness < 20%)
   - Are results off-topic for the hypothesis?
   - Is the query too broad, matching irrelevant content?
   - Are we searching in the wrong domain/timeframe?
   - Could more specific terms or constraints improve precision?

3. **High rejection themes**
   - What patterns appear in rejection_themes?
   - Do rejections suggest query mismatch (wrong source) or need refinement (right source, wrong query)?

4. **Diminishing returns**
   - Are recent queries less effective than earlier ones?
   - Are we exhausting the source's depth, or using less optimal query strategies?

**Consider Source Capabilities:**
Refer to the SOURCE CHARACTERISTICS above to understand:
- What query_strategies this source supports (keyword_search, boolean_operators, quoted_phrases, etc.)
- What characteristics define this source (community_discussions, formal_documents, realtime_feeds, etc.)
- What typical_result_count and max_queries_recommended suggest about source depth

**Quality Improvement Strategies:**
Based on the query_history patterns and source capabilities, consider:
- If too specific (0 results): Remove restrictive operators, broaden terminology, expand timeframes
- If too broad (low acceptance): Add specific constraints, use source-specific filters, narrow domain
- If wrong approach: Try different query_strategies from source metadata (e.g., subreddit_specific vs keyword_search)
- If saturation suspected: Verify with different angles, not just variations of same query

**Integration Intelligence:**
When suggesting next_query, ensure it:
- Aligns with source's supported query_strategies
- Learns from effectiveness patterns (avoid repeating failed approaches)
- Targets specific information_gaps
- Uses appropriate specificity for this source type (government databases vs social media vs web search)

DECISION FRAMEWORK:

**SATURATED** if:
1. High confidence we've found all relevant information that exists
2. Recent queries yielding only duplicates or off-topic results
3. Information clearly doesn't exist in this source
4. Queries are repeating similar patterns without new results
5. Diminishing returns evident (effectiveness dropping)

**CONTINUE** if:
1. Reasonable chance different query formulation could find more
2. Identified gaps that could be addressed with targeted queries
3. Source characteristics suggest more depth available
4. Haven't tried key query strategies yet
5. Recent queries still productive (finding new results)

SATURATION GUIDANCE:
- **Query effectiveness**: Are we getting better or worse results over time?
- **Terminology learning**: Have we found keywords/phrases that work well?
- **Information existence**: Does the info likely exist in this source given its nature?
- **Diminishing returns**: Are new queries adding meaningful value?
- **Pattern recognition**: If 3+ queries yield no new results → likely saturated
- **Quality decline**: If results declining in relevance/quality → likely saturated
- **Duplicate signals**: If hitting mostly duplicates → likely saturated
- **Source depth**: Consider source characteristics (e.g., Twitter saturates quickly, SAM.gov has deep archives)

IMPORTANT CONSIDERATIONS:
- Be **adaptive**: Different sources saturate at different rates
- Be **evidence-based**: Use query history trends, not arbitrary thresholds
- Be **goal-oriented**: Focus on addressing the hypothesis, not exhaustive searching
- Be **resource-aware**: Balance thoroughness with efficiency

Return JSON:
{
    "decision": "SATURATED" or "CONTINUE",
    "reasoning": "2-4 sentences explaining your decision. Include: (1) query quality analysis from patterns above (zero results, low acceptance, etc.), (2) whether issues stem from source limitations or query formulation, (3) saturation confidence based on evidence",
    "confidence": 0-100,  // Confidence in this decision (0=uncertain, 100=very confident)
    "existence_confidence": 0-100,  // Confidence information exists in source (0=unlikely, 100=very likely)
    "next_query_suggestion": "If CONTINUE, specific query to try next (empty if SATURATED)",
    "next_query_reasoning": "If CONTINUE, why this query should work (empty if SATURATED)",
    "expected_value": "high" | "medium" | "low",  // Expected value of next query
    "remaining_gaps": [...]  // Updated list of specific info gaps still unaddressed (can be same as input or modified)
}

**If CONTINUE**: Provide a SPECIFIC, ACTIONABLE query that targets identified gaps or uses a different strategy than previous queries. Do not repeat failed approaches.

**If SATURATED**: Explain what led to saturation (e.g., repeated duplicates, exhausted strategies, info doesn't exist).
