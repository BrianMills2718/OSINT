{# Goal Decomposition Prompt for Recursive Research Agent #}
{# Decomposes a goal into sub-goals with dependency tracking #}
{# temporal_context: true #}
You are a research agent decomposing a goal into sub-goals.

{{ temporal_context }}

ORIGINAL OBJECTIVE: {{ original_objective }}

GOAL TO DECOMPOSE: {{ goal }}

WHY DECOMPOSITION IS NEEDED:
{{ decomposition_rationale }}

GOAL ANCESTRY:
{% if goal_stack %}
{% for g in goal_stack %}
  {{ loop.index }}. {{ g }}
{% endfor %}
{% else %}
  (root goal)
{% endif %}

EVIDENCE SO FAR: {{ evidence_summary }}

AVAILABLE DATA SOURCES:
{{ sources_text }}

EXISTING GOALS (avoid redundancy):
{{ existing_goals }}

CONSTRAINTS:
- Remaining depth: {{ remaining_depth }} levels
- Remaining goals: {{ remaining_goals }}

DECOMPOSITION STRATEGY for thorough research:

For INVESTIGATIVE goals (about companies, people, entities):
- Create sub-goals BY SOURCE TYPE to ensure comprehensive coverage:
  - Government contracts → USAspending, SAM.gov, GovInfo
  - Political/lobbying → FEC, Congress.gov
  - Legal/controversies → CourtListener, SEC enforcement
  - News/media → NewsAPI, web search
  - Financial → SEC filings (10-K, 8-K)

For TOPICAL goals (about a topic/issue):
- Create sub-goals BY ANGLE or PERSPECTIVE
- Each angle can query different sources

Create sub-goals that:
1. Together provide COMPREHENSIVE coverage (not just the first matching source)
2. Are INDEPENDENT (can run in parallel across different source types)
3. Target SPECIFIC sources (e.g., "Find X in USAspending" not just "Find X contracts")
4. DON'T duplicate existing goals
5. Aim for 5-10 sub-goals for depth-1 decomposition of investigative queries

DEPENDENCY GUIDANCE - When to declare dependencies:

INDEPENDENT goals (dependencies: []):
- Data collection from different sources (can run in parallel)
- Example: Research Company A contracts, Research Company B contracts
- Example: Find USAspending data, Find FEC data, Find NewsAPI articles

DEPENDENT goals (dependencies: [0, 1, ...]):
- COMPARATIVE analysis: "Compare X vs Y" requires both X and Y data first
  Example: Goal 0: "Find Palantir contracts", Goal 1: "Find Anduril contracts",
           Goal 2 (depends on [0,1]): "Compare contract portfolios and identify competitive positioning"

- SYNTHESIS/INTEGRATION: Combining findings from multiple sub-goals
  Example: Goal 0: "Government contracts", Goal 1: "Legal issues",
           Goal 2 (depends on [0,1]): "Identify patterns between contract awards and legal problems"

- SEQUENTIAL data collection: Later goal needs results from earlier goal
  Example: Goal 0: "Find top contractors by spending",
           Goal 1 (depends on [0]): "Research controversies for top 5 contractors identified"

- FOLLOW-UP investigation: Deep-dive into specific entities/topics discovered
  Example: Goal 0: "Extract key entities from initial research",
           Goal 1 (depends on [0]): "Investigate relationships between identified entities"

WHEN NOT to use dependencies:
- Independent data gathering across different sources → dependencies: []
- Parallel exploration of different angles → dependencies: []
- Broad coverage queries → dependencies: []

CRITICAL: If goal description contains "compare", "analyze relationship", "synthesize",
"based on findings", or "after identifying" → likely needs dependencies!

Return JSON:
{% raw %}
{
    "sub_goals": [
        {
            "description": "Clear, actionable goal description",
            "rationale": "How this helps achieve the parent goal",
            "dependencies": [0, 1],  // Indices of sub-goals this depends on (empty if independent)
            "estimated_complexity": "atomic|simple|moderate|complex"
        }
    ],
    "coverage_assessment": "How these sub-goals cover the parent goal"
}
{% endraw %}
